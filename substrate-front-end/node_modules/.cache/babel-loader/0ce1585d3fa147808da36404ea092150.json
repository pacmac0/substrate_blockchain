{"ast":null,"code":"import _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\"; // Copyright 2017-2021 @polkadot/hw-ledger authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport \"./detectPackage.js\";\nimport { transports } from '@polkadot/hw-ledger-transports';\nimport { assert, u8aToBuffer } from '@polkadot/util';\nimport { LEDGER_DEFAULT_ACCOUNT, LEDGER_DEFAULT_CHANGE, LEDGER_DEFAULT_INDEX, LEDGER_SUCCESS_CODE } from \"./constants.js\";\nimport { ledgerApps } from \"./defaults.js\";\nexport { packageInfo } from \"./packageInfo.js\";\n\nvar _app = /*#__PURE__*/_classPrivateFieldLooseKey(\"app\");\n\nvar _chain = /*#__PURE__*/_classPrivateFieldLooseKey(\"chain\");\n\nvar _transport = /*#__PURE__*/_classPrivateFieldLooseKey(\"transport\");\n\nvar _getApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"getApp\");\n\nvar _withApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"withApp\");\n\nvar _wrapError = /*#__PURE__*/_classPrivateFieldLooseKey(\"wrapError\"); // A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\n\n\nexport class Ledger {\n  constructor(_transport2, chain) {\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _getApp, {\n      writable: true,\n      value: async () => {\n        if (!_classPrivateFieldLooseBase(this, _app)[_app]) {\n          const def = transports.find(({\n            type\n          }) => type === _classPrivateFieldLooseBase(this, _transport)[_transport]);\n          assert(def, () => `Unable to find a transport for ${_classPrivateFieldLooseBase(this, _transport)[_transport]}`);\n          const transport = await def.create();\n          _classPrivateFieldLooseBase(this, _app)[_app] = ledgerApps[_classPrivateFieldLooseBase(this, _chain)[_chain]](transport);\n        }\n\n        return _classPrivateFieldLooseBase(this, _app)[_app];\n      }\n    });\n    Object.defineProperty(this, _withApp, {\n      writable: true,\n      value: async fn => {\n        try {\n          const app = await _classPrivateFieldLooseBase(this, _getApp)[_getApp]();\n          return await fn(app);\n        } catch (error) {\n          _classPrivateFieldLooseBase(this, _app)[_app] = null;\n          throw error;\n        }\n      }\n    });\n    Object.defineProperty(this, _wrapError, {\n      writable: true,\n      value: async promise => {\n        const result = await promise;\n        assert(result.return_code === LEDGER_SUCCESS_CODE, () => result.error_message);\n        return result;\n      }\n    }); // u2f is deprecated\n\n    assert(['hid', 'webusb'].includes(_transport2), () => `Unsupported transport ${_transport2}`);\n    assert(Object.keys(ledgerApps).includes(chain), () => `Unsupported chain ${chain}`);\n    _classPrivateFieldLooseBase(this, _chain)[_chain] = chain;\n    _classPrivateFieldLooseBase(this, _transport)[_transport] = _transport2;\n  }\n\n  async getAddress(confirm = false, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        address,\n        pubKey\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n      return {\n        address,\n        publicKey: `0x${pubKey}`\n      };\n    });\n  }\n\n  async getVersion() {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        device_locked: isLocked,\n        major,\n        minor,\n        patch,\n        test_mode: isTestMode\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getVersion());\n      return {\n        isLocked,\n        isTestMode,\n        version: [major, minor, patch]\n      };\n    });\n  }\n\n  async sign(message, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const buffer = u8aToBuffer(message);\n      const {\n        signature\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n      return {\n        signature: `0x${signature.toString('hex')}`\n      };\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/pacmac/Documents/GitHub/Blockchain/substarte_blockchain/substrate-front-end-template/node_modules/@polkadot/hw-ledger/index.js"],"names":["_classPrivateFieldLooseBase","_classPrivateFieldLooseKey","transports","assert","u8aToBuffer","LEDGER_DEFAULT_ACCOUNT","LEDGER_DEFAULT_CHANGE","LEDGER_DEFAULT_INDEX","LEDGER_SUCCESS_CODE","ledgerApps","packageInfo","_app","_chain","_transport","_getApp","_withApp","_wrapError","Ledger","constructor","_transport2","chain","Object","defineProperty","writable","value","def","find","type","transport","create","fn","app","error","promise","result","return_code","error_message","includes","keys","getAddress","confirm","accountOffset","addressOffset","account","addressIndex","change","address","pubKey","publicKey","getVersion","device_locked","isLocked","major","minor","patch","test_mode","isTestMode","version","sign","message","buffer","signature","toString"],"mappings":"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","sourcesContent":["import _classPrivateFieldLooseBase from \"@babel/runtime/helpers/esm/classPrivateFieldLooseBase\";\nimport _classPrivateFieldLooseKey from \"@babel/runtime/helpers/esm/classPrivateFieldLooseKey\";\n// Copyright 2017-2021 @polkadot/hw-ledger authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport \"./detectPackage.js\";\nimport { transports } from '@polkadot/hw-ledger-transports';\nimport { assert, u8aToBuffer } from '@polkadot/util';\nimport { LEDGER_DEFAULT_ACCOUNT, LEDGER_DEFAULT_CHANGE, LEDGER_DEFAULT_INDEX, LEDGER_SUCCESS_CODE } from \"./constants.js\";\nimport { ledgerApps } from \"./defaults.js\";\nexport { packageInfo } from \"./packageInfo.js\";\n\nvar _app = /*#__PURE__*/_classPrivateFieldLooseKey(\"app\");\n\nvar _chain = /*#__PURE__*/_classPrivateFieldLooseKey(\"chain\");\n\nvar _transport = /*#__PURE__*/_classPrivateFieldLooseKey(\"transport\");\n\nvar _getApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"getApp\");\n\nvar _withApp = /*#__PURE__*/_classPrivateFieldLooseKey(\"withApp\");\n\nvar _wrapError = /*#__PURE__*/_classPrivateFieldLooseKey(\"wrapError\");\n\n// A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\nexport class Ledger {\n  constructor(_transport2, chain) {\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _getApp, {\n      writable: true,\n      value: async () => {\n        if (!_classPrivateFieldLooseBase(this, _app)[_app]) {\n          const def = transports.find(({\n            type\n          }) => type === _classPrivateFieldLooseBase(this, _transport)[_transport]);\n          assert(def, () => `Unable to find a transport for ${_classPrivateFieldLooseBase(this, _transport)[_transport]}`);\n          const transport = await def.create();\n          _classPrivateFieldLooseBase(this, _app)[_app] = ledgerApps[_classPrivateFieldLooseBase(this, _chain)[_chain]](transport);\n        }\n\n        return _classPrivateFieldLooseBase(this, _app)[_app];\n      }\n    });\n    Object.defineProperty(this, _withApp, {\n      writable: true,\n      value: async fn => {\n        try {\n          const app = await _classPrivateFieldLooseBase(this, _getApp)[_getApp]();\n          return await fn(app);\n        } catch (error) {\n          _classPrivateFieldLooseBase(this, _app)[_app] = null;\n          throw error;\n        }\n      }\n    });\n    Object.defineProperty(this, _wrapError, {\n      writable: true,\n      value: async promise => {\n        const result = await promise;\n        assert(result.return_code === LEDGER_SUCCESS_CODE, () => result.error_message);\n        return result;\n      }\n    });\n    // u2f is deprecated\n    assert(['hid', 'webusb'].includes(_transport2), () => `Unsupported transport ${_transport2}`);\n    assert(Object.keys(ledgerApps).includes(chain), () => `Unsupported chain ${chain}`);\n    _classPrivateFieldLooseBase(this, _chain)[_chain] = chain;\n    _classPrivateFieldLooseBase(this, _transport)[_transport] = _transport2;\n  }\n\n  async getAddress(confirm = false, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        address,\n        pubKey\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n      return {\n        address,\n        publicKey: `0x${pubKey}`\n      };\n    });\n  }\n\n  async getVersion() {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const {\n        device_locked: isLocked,\n        major,\n        minor,\n        patch,\n        test_mode: isTestMode\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.getVersion());\n      return {\n        isLocked,\n        isTestMode,\n        version: [major, minor, patch]\n      };\n    });\n  }\n\n  async sign(message, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return _classPrivateFieldLooseBase(this, _withApp)[_withApp](async app => {\n      const buffer = u8aToBuffer(message);\n      const {\n        signature\n      } = await _classPrivateFieldLooseBase(this, _wrapError)[_wrapError](app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n      return {\n        signature: `0x${signature.toString('hex')}`\n      };\n    });\n  }\n\n}"]},"metadata":{},"sourceType":"module"}